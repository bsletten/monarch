# This file contains basic Makefile includes that contain all 
# common building instructions for all binaries and packages.

.PHONY: all build-setup build-clean build-directories build-headers build-objects build-libraries build-executables clean clean-objects clean-libraries

all: build-objects build-libraries build-executables

PLATFORM=@PLATFORM@
BUILD_FOR_LINUX=@BUILD_FOR_LINUX@
BUILD_FOR_WINDOWS=@BUILD_FOR_WINDOWS@
BUILD_FOR_MACOS=@BUILD_FOR_MACOS@

AR_FLAGS = cr
MONARCH = $(realpath @MONARCH_DIR@)
INCLUDES = -I$(MONARCH)/dist/include 

CWD = $(shell pwd)
ifndef HEADER_DIST_DIR
HEADER_DIST_DIR = dist/include/monarch/$(notdir $(CWD))
endif

ifdef PRINT_COMMANDS
PCMD=
else
PCMD=@
endif

# Platform-specific variables and build rules
.SECONDEXPANSION:

ifeq ($(BUILD_FOR_LINUX),yes)
PLATFORM_NAME=LINUX
PN=$(PLATFORM_NAME)
LIB_PREFIX=lib
DYNAMIC_LIB_EXT=so
STATIC_LIB_EXT=a
include @MONARCH_DIR@/setup/Makefile.linux
endif

ifeq ($(BUILD_FOR_MACOS),yes)
PLATFORM_NAME=MACOS
PN=$(PLATFORM_NAME)
LIB_PREFIX=lib
DYNAMIC_LIB_EXT=dylib
STATIC_LIB_EXT=a
include @MONARCH_DIR@/setup/Makefile.macos
endif

ifeq ($(BUILD_FOR_WINDOWS),yes)
PLATFORM_NAME=WINDOWS
PN=$(PLATFORM_NAME)
LIB_PREFIX=
DYNAMIC_LIB_EXT=dll
STATIC_LIB_EXT=lib
include @MONARCH_DIR@/setup/Makefile.mingw32
endif

# Platform-agnostic build rules 

build-setup:

build-clean:

$(ALL_DIRECTORIES):
	mkdir -p $@

clean: build-clean clean-libraries clean-objects

build-headers: $(ALL_HEADERS)

build-objects: $(ALL_DIRECTORIES) $(ALL_SOURCES) $(ALL_OBJECTS)

build-libraries: $(ALL_DIRECTORIES) $(ALL_LIBRARIES)

build-executables: $(ALL_DIRECTORIES) $(ALL_EXECUTABLES)
