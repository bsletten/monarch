# This file contains basic Makefile includes that contain all 
# common building instructions for all binaries and packages.

.PHONY: all build-setup build-clean build-directories build-objects build-libraries build-executables clean clean-objects clean-libraries

all: build-objects build-libraries build-executables

PLATFORM=@PLATFORM@
BUILD_FOR_LINUX=@BUILD_FOR_LINUX@
BUILD_FOR_WINDOWS=@BUILD_FOR_WINDOWS@
BUILD_FOR_MACOS=@BUILD_FOR_MACOS@

AR_FLAGS = cr
DBCORE = @DBCOREDIR@
INCLUDES = \
	-I$(DBCORE)/app/cpp \
	-I$(DBCORE)/compress/cpp \
	-I$(DBCORE)/config/cpp \
	-I$(DBCORE)/crypto/cpp \
	-I$(DBCORE)/data/cpp \
	-I$(DBCORE)/event/cpp \
	-I$(DBCORE)/fiber/cpp \
	-I$(DBCORE)/http/cpp \
	-I$(DBCORE)/io/cpp \
	-I$(DBCORE)/logging/cpp \
	-I$(DBCORE)/mail/cpp \
	-I$(DBCORE)/modest/cpp \
	-I$(DBCORE)/net/cpp \
	-I$(DBCORE)/rt/cpp \
	-I$(DBCORE)/sphinx/cpp \
	-I$(DBCORE)/sql/cpp \
	-I$(DBCORE)/sqlite3/cpp \
	-I$(DBCORE)/mysql/cpp \
	-I$(DBCORE)/test/cpp \
	-I$(DBCORE)/upnp/cpp \
	-I$(DBCORE)/util/cpp \
	-I$(DBCORE)/validation/cpp

MODULE_BASE_DIR = $(shell pwd)

ifdef PRINT_COMMANDS
PCMD=
else
PCMD=@
endif

# Platform-specific variables and build rules
.SECONDEXPANSION:

ifeq ($(BUILD_FOR_LINUX),yes)
include @DBCOREDIR@/setup/Makefile.linux
endif
ifeq ($(BUILD_FOR_MACOS),yes)
include @DBCOREDIR@/setup/Makefile.macos
endif
ifeq ($(BUILD_FOR_WINDOWS),yes)
include @DBCOREDIR@/setup/Makefile.mingw32
endif

# Platform-agnostic build rules 

build-setup:

build-clean:

$(ALL_DIRECTORIES):
	mkdir -p $@

clean: build-clean clean-libraries clean-objects

build-objects: $(ALL_DIRECTORIES) $(ALL_SOURCES) $(ALL_OBJECTS)

build-libraries: $(ALL_DIRECTORIES) $(ALL_LIBRARIES)

build-executables: $(ALL_DIRECTORIES) $(ALL_EXECUTABLES)
